<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Quant-Desk</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #1a1a2e;
            --bg-card: #23233b;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0b0;
            --border-color: rgba(255, 255, 255, 0.1);
            --accent-purple: #9b59b6;
            --accent-blue: #3498db;
            --accent-green: #2ecc71;
            --accent-yellow: #f1c40f;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }

        body { 
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--bg-dark); 
            color: var(--text-primary); 
            margin: 0; 
            padding: 24px; 
            line-height: 1.6;
        }

        .container { 
            max-width: 1400px; 
            margin: auto; 
        }

        h1, h2 { 
            color: #ffffff; 
            font-weight: 600;
            border-bottom: 2px solid var(--accent-purple); 
            padding-bottom: 12px;
            margin-bottom: 24px;
        }
        
        h1 { font-size: 2.2em; }
        h2 { font-size: 1.5em; }
        p { color: var(--text-secondary); }

        .overview-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 16px; 
            margin-top: 24px; 
        }

        .ticker-button { 
            background-color: var(--bg-card); 
            color: var(--text-primary); 
            border: 1px solid var(--border-color); 
            padding: 12px 16px; 
            border-radius: 8px; 
            cursor: pointer; 
            text-align: center; 
            font-weight: 600; 
            font-size: 16px; 
            transition: all 0.25s ease-in-out; 
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .ticker-button:hover { 
            background-color: #2a2a45; 
            transform: translateY(-3px); 
            box-shadow: 0 6px 12px var(--shadow-color);
            border-color: var(--accent-blue);
        }

        .ticker-button.active { 
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            color: white;
            border-color: var(--accent-blue);
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 5px 10px rgba(142, 68, 173, 0.4);
        }

        .divider { 
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 48px 0; 
        }

        #detail-view {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        #detail-view.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .detail-content { 
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 24px;
            align-items: flex-start;
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        .detail-stats { grid-column: 1 / 2; }
        .detail-chart { grid-column: 2 / 3; }
        .raw-data-section { grid-column: 1 / -1; margin-top: 24px; }

        #prediction-box { 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 24px; 
            font-weight: 600; 
            text-align: center; 
            font-size: 1.3em;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
        }

        .prediction-buy { 
            background: linear-gradient(135deg, #16a085, var(--accent-green));
            border: 1px solid var(--accent-green);
        }
        .prediction-hold { 
            background: linear-gradient(135deg, #d35400, var(--accent-yellow)); 
            border: 1px solid var(--accent-yellow);
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 16px;
        }

        th, td { 
            text-align: left; 
            padding: 14px 12px; 
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95em;
        }

        th { 
            font-weight: 600; 
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.8em;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }

        td:nth-child(2) { 
            text-align: right; 
            font-weight: 600; 
            color: var(--text-primary);
        }
        
        @media (max-width: 900px) {
            .detail-content {
                grid-template-columns: 1fr;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>AI Quant-Desk</h1>
        <p>Real-time market analysis powered by machine learning. Click a ticker below to view its detailed performance and AI-generated trading signal. 游릭 = BUY Signal, 游리 = HOLD/SELL Signal.</p>
        <div id="overview-grid" class="overview-grid"></div>
        
        <hr class="divider">
        
        <div id="detail-view">
            <h1 id="detail-ticker">Select a ticker to begin</h1>
            <div class="detail-content">
                <div class="detail-stats card">
                    <h2>AI Prediction</h2>
                    <div id="prediction-box">Loading...</div>
                    <h2>Strategy Performance</h2>
                    <div id="summary-table"></div>
                </div>
                <div class="detail-chart card">
                    <h2>Price History (1Y)</h2>
                    <div id="price-chart"></div>
                </div>
                <div class="raw-data-section card">
                    <h2>Recent Market Data</h2>
                    <div id="raw-data-table"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const overviewGrid = document.getElementById('overview-grid');
            const detailView = document.getElementById('detail-view');
            const detailTicker = document.getElementById('detail-ticker');
            const predictionBox = document.getElementById('prediction-box');
            const summaryTable = document.getElementById('summary-table');
            const priceChart = document.getElementById('price-chart');
            const rawDataTable = document.getElementById('raw-data-table');

            let masterData = {};
            let currentTicker = null;

            fetch('data.json')
                .then(response => response.json())
                .then(data => {
                    masterData = data;
                    renderOverview();
                    if (masterData.predictions && masterData.predictions.length > 0) {
                        const firstTicker = masterData.predictions[0].Ticker;
                        updateDetailView(firstTicker);
                    }
                }).catch(error => {
                    console.error('Error loading data.json:', error);
                    detailTicker.textContent = "Error: Could not load data.json. Please run the pipeline.";
                });

            function renderOverview() {
                overviewGrid.innerHTML = '';
                masterData.predictions.forEach(p => {
                    const button = document.createElement('button');
                    button.className = 'ticker-button';
                    button.id = `btn-${p.Ticker}`;
                    const emoji = p.Signal === 1 ? '游릭' : '游리';
                    button.textContent = `${emoji} ${p.Ticker}`;
                    button.onclick = () => updateDetailView(p.Ticker);
                    overviewGrid.appendChild(button);
                });
            }

            function updateDetailView(ticker) {
                if (currentTicker) {
                    document.getElementById(`btn-${currentTicker}`).classList.remove('active');
                }
                document.getElementById(`btn-${ticker}`).classList.add('active');
                currentTicker = ticker;
                
                detailView.classList.add('visible');
                detailTicker.textContent = `Detailed Analysis: ${ticker}`;

                // Update Prediction
                const prediction = masterData.predictions.find(p => p.Ticker === ticker);
                if (prediction) {
                    predictionBox.innerHTML = `<div>Signal: ${prediction.Signal === 1 ? 'BUY' : 'HOLD / SELL'}</div><div>Confidence: ${(prediction.Confidence * 100).toFixed(2)}%</div>`;
                    predictionBox.className = prediction.Signal === 1 ? 'prediction-buy' : 'prediction-hold';
                }

                // Update Summary Table
                const summary = masterData.summary[ticker];
                let summaryTableHTML = '<table><thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody>';
                if (summary) {
                    for (const [key, value] of Object.entries(summary)) {
                        summaryTableHTML += `<tr><td>${key}</td><td>${value.toFixed(2)}</td></tr>`;
                    }
                }
                summaryTableHTML += '</tbody></table>';
                summaryTable.innerHTML = summaryTableHTML;

                // Update Price Chart
                const history = masterData.priceHistory[ticker];
                const trace = {
                    x: history.map(d => d.Date),
                    close: history.map(d => d.Close),
                    high: history.map(d => d.High),
                    low: history.map(d => d.Low),
                    open: history.map(d => d.Open),
                    type: 'candlestick',
                    name: ticker
                };
                const layout = {
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: {
                        color: 'var(--text-primary)'
                    }
                };
                Plotly.newPlot(priceChart, [trace], layout, {responsive: true});

                // Update Raw Data Table
                const last5Days = history.slice(-5);
                let rawDataHTML = '<table><thead><tr><th>Date</th><th>Open</th><th>High</th><th>Low</th><th>Close</th><th>Volume</th></tr></thead><tbody>';
                last5Days.forEach(d => {
                    rawDataHTML += `<tr><td>${d.Date}</td><td>${d.Open.toFixed(2)}</td><td>${d.High.toFixed(2)}</td><td>${d.Low.toFixed(2)}</td><td>${d.Close.toFixed(2)}</td><td>${d.Volume}</td></tr>`;
                });
                rawDataHTML += '</tbody></table>';
                rawDataTable.innerHTML = rawDataHTML;
            }
        });
    </script>
</body>
</html>